<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pomodoro 25/5 ‚Äî Focus & Wake</title>
    <meta
      name="description"
      content="Pomodoro 25/5 con herramientas anti-sue√±o: caminar, agua fr√≠a, respiraci√≥n, hidrataci√≥n y control de cafe√≠na."
    />
    <link rel="icon" href="data:," />

    <style>
  :root{
    --bg0:#070A12;
    --bg1:#0B1022;
    --card: rgba(255,255,255,.08);
    --card2: rgba(255,255,255,.06);
    --stroke: rgba(255,255,255,.14);
    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.68);
    --muted2: rgba(255,255,255,.55);
    --good: rgba(77, 255, 158, .95);
    --warn: rgba(255, 214, 102, .95);
    --shadow: 0 18px 60px rgba(0,0,0,.55);
    --shadow2: 0 10px 30px rgba(0,0,0,.35);
    --r: 22px;
    --r2: 16px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  }

  /* ====== THEME: LIGHT ====== */
body[data-theme="light"]{
  --bg0:#F4F6FF;
  --bg1:#E9ECFF;

  --card: rgba(10, 15, 40, .06);
  --card2: rgba(10, 15, 40, .04);
  --stroke: rgba(10, 15, 40, .12);

  --text: rgba(10, 15, 40, .92);
  --muted: rgba(10, 15, 40, .64);
  --muted2: rgba(10, 15, 40, .52);

  --shadow: 0 18px 60px rgba(10, 15, 40, .18);
  --shadow2: 0 10px 30px rgba(10, 15, 40, .12);
}

  *{box-sizing:border-box}
  html,body{height:100%; width:100%;}
  body{
    margin:0;
    color:var(--text);
    font-family:var(--sans);
    background:
      radial-gradient(1200px 700px at 15% 20%, rgba(124, 92, 255, .28), transparent 60%),
      radial-gradient(1000px 700px at 85% 30%, rgba(77, 255, 158, .18), transparent 60%),
      radial-gradient(900px 600px at 55% 95%, rgba(255, 214, 102, .12), transparent 55%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    overflow-x:hidden;
  }

  body[data-theme="light"]{
  background:
    radial-gradient(1200px 700px at 15% 20%, rgba(124, 92, 255, .18), transparent 60%),
    radial-gradient(1000px 700px at 85% 30%, rgba(77, 255, 158, .12), transparent 60%),
    radial-gradient(900px 600px at 55% 95%, rgba(255, 214, 102, .10), transparent 55%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
}

  /* IMPORTANTE: no uses transform en padres del modal */
  .wrap{
    min-height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:22px;
  }

.app{
  width: min(980px, 100%);
  display: grid;
  grid-template-columns: 1fr;
  gap: 18px;
}
  @media (max-width: 980px){
    .app{grid-template-columns:1fr}
  }

  .card{
    background: linear-gradient(180deg, var(--card), var(--card2));
    border: 1px solid var(--stroke);
    border-radius: var(--r);
    box-shadow: var(--shadow);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    overflow:hidden;
    position:relative;
  }
  .card:before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(900px 240px at 15% 0%, rgba(255,255,255,.12), transparent 60%),
      radial-gradient(700px 240px at 85% 10%, rgba(255,255,255,.08), transparent 60%);
    pointer-events:none;
  }

  .pad{padding:18px}

  .header{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:14px;
  }
  .title{
    display:flex; gap:12px; align-items:center;
  }
  .badge{
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 12px;
    border-radius: 999px;
    border:1px solid var(--stroke);
    background: rgba(0,0,0,.18);
    box-shadow: var(--shadow2);
    font-size:13px;
    color:var(--muted);
    user-select:none;
  }
  .dot{
    width:10px; height:10px; border-radius:99px;
    background: var(--good);
    box-shadow: 0 0 0 4px rgba(77,255,158,.14);
  }
  .dot.break{background: var(--warn); box-shadow:0 0 0 4px rgba(255,214,102,.14);}
  .dot.paused{background: rgba(255,255,255,.35); box-shadow:0 0 0 4px rgba(255,255,255,.08);}

  h1{
    margin:0;
    font-size:18px;
    letter-spacing:.2px;
  }
  .sub{
    margin:6px 0 0 0;
    color:var(--muted);
    font-size:13px;
    line-height:1.35;
  }

  .rightActions{
    display:flex; flex-wrap:wrap; gap:10px; justify-content:flex-end; align-items:center;
  }

  .toggle{
    display:flex; align-items:center; gap:8px;
    padding:8px 10px;
    border-radius: 999px;
    border:1px solid var(--stroke);
    background: rgba(0,0,0,.18);
    box-shadow: var(--shadow2);
    user-select:none;
    font-size:12.5px;
    color:var(--muted);
  }

  .menuTrigger{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:40px;
    height:40px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.20);
    box-shadow: var(--shadow2);
    color: var(--text);
    cursor:pointer;
    transition: transform .08s ease, background .12s ease, border-color .12s ease;
  }
  .menuTrigger:hover{background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.24);}
  .menuTrigger:active{transform: translateY(1px);}

  .switch{
    width:44px; height:26px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.18);
    background: rgba(255,255,255,.08);
    position:relative;
    cursor:pointer;
  }
  .knob{
    position:absolute; top:3px; left:3px;
    width:20px; height:20px; border-radius:99px;
    background: rgba(255,255,255,.82);
    transition: all .18s ease;
    box-shadow: 0 8px 18px rgba(0,0,0,.35);
  }
  .switch.on{background: rgba(77,255,158,.18); border-color: rgba(77,255,158,.35);}
  .switch.on .knob{left:21px; background: rgba(77,255,158,.95);}
  .switch.warn.on{background: rgba(255,214,102,.18); border-color: rgba(255,214,102,.35);}
  .switch.warn.on .knob{background: rgba(255,214,102,.95);}
  .switch.neutral.on{background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.22);}
  .switch.neutral.on .knob{background: rgba(255,255,255,.92);}
  .switch.theme.on{background: rgba(255,255,255,.24); border-color: rgba(255,255,255,.36);}
  .switch.theme.on .knob{background: rgba(255,255,255,.92);}

  .switch.good.on{
    background: rgba(77, 228, 255, 0.18);
    border-color: rgba(77,255,158,.35);
  }
  .switch.good.on .knob{
    background: rgba(77, 216, 255, 0.95);
  }

  .timerArea{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:16px;
    margin-top:14px;
  }
  @media (max-width: 720px){
    .timerArea{grid-template-columns:1fr}
  }

  .big{
    padding:18px;
    border-radius: var(--r2);
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
    box-shadow: var(--shadow2);
    position:relative;
    overflow:hidden;
  }
  .big:after{
    content:"";
    position:absolute; inset:-1px;
    background: radial-gradient(700px 240px at 20% 10%, rgba(255,255,255,.10), transparent 55%);
    pointer-events:none;
  }

  .clockRow{display:flex; align-items:center; justify-content:space-between; gap:12px;}
  .time{
    font-family: var(--mono);
    font-size:56px;
    letter-spacing:-1px;
    margin:10px 0 6px 0;
    line-height:1;
  }
  .phaseLabel{
    display:flex; align-items:center; gap:10px;
    color: var(--muted);
    font-size:13px;
  }

  .pill{
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
    color: var(--muted);
    font-size:12px;
    user-select:none;
  }

  .progressWrap{margin-top:12px}
  .bar{
    height:10px;
    border-radius:999px;
    background: rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.10);
    overflow:hidden;
  }
  .fill{
    height:100%;
    border-radius:999px;
    width:0%;
    transition: width .25s ease;
    background: linear-gradient(90deg, rgba(77,255,158,.95), rgba(124,92,255,.85));
  }
  .fill.break{
    background: linear-gradient(90deg, rgba(255,214,102,.95), rgba(124,92,255,.70));
  }

  .controls{
    margin-top:14px;
    display:flex; flex-wrap:wrap; gap:10px;
  }

  .btn{
    appearance:none; border:0;
    border-radius: 14px;
    padding:10px 12px;
    font-size:13px;
    color: var(--text);
    background: rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.14);
    box-shadow: var(--shadow2);
    cursor:pointer;
    transition: transform .08s ease, background .12s ease, border-color .12s ease;
    user-select:none;
  }
  .btn:hover{background: rgba(255,255,255,.14);}
  .btn:active{transform: translateY(1px);}
  .btn.primary{
    background: rgba(77,255,158,.16);
    border-color: rgba(77,255,158,.28);
  }
  .btn.primary:hover{background: rgba(77,255,158,.22);}
  .btn.warn{
    background: rgba(255,214,102,.14);
    border-color: rgba(255,214,102,.28);
  }
  .btn.warn:hover{background: rgba(255,214,102,.20);}
  .btn.ghost{background: rgba(0,0,0,.16);}

  .kbs{
    margin-top:10px;
    color:var(--muted2);
    font-size:12px;
    display:flex; flex-wrap:wrap; gap:10px;
  }
  .kbd{
    font-family:var(--mono);
    font-size:11.5px;
    padding:4px 8px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.16);
    color: var(--muted);
  }

  .sideGrid{display:grid; gap:14px;}
  .sectionTitle{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px;
    margin:0 0 10px 0;
  }
  .sectionTitle h2{
    margin:0;
    font-size:14px;
    letter-spacing:.2px;
    color: var(--text);
  }
  .mini{
    padding:14px;
    border-radius: var(--r2);
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.16);
    box-shadow: var(--shadow2);
  }

  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
  @media (max-width: 980px){ .grid2{grid-template-columns:1fr} }

  .list{
    margin:0; padding:0;
    list-style:none;
    display:grid; gap:8px;
  }
  .item{
    display:flex; gap:10px; align-items:flex-start;
    padding:10px 10px;
    border-radius: 14px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.06);
  }

  .itText{flex:1}
  .itTop{display:flex; justify-content:space-between; gap:10px; align-items:baseline}
  .itTitle{font-size:13px; color:var(--text); margin:0}
  .itDesc{font-size:12px; color:var(--muted); margin:4px 0 0 0; line-height:1.3}
  .smallTag{
    font-family:var(--mono);
    font-size:11px;
    color:var(--muted);
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.14);
    padding:3px 8px;
    border-radius:999px;
    white-space:nowrap;
  }

  .toast{
    position: fixed;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
    width: min(760px, calc(100% - 28px));
    border-radius: 18px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: var(--shadow);
    padding: 12px 14px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 12px;
    z-index: 50;
  }
  .toast strong{display:block; font-size:13px}
  .toast span{display:block; font-size:12px; color:var(--muted); margin-top:2px}
  .toast .btn{padding:8px 10px; border-radius: 12px}

  .pulse{ animation: pulse 1.3s ease-in-out infinite; }
  @keyframes pulse{
    0%{transform: translateY(0)}
    50%{transform: translateY(-1px)}
    100%{transform: translateY(0)}
  }

  /* =========================
     MODAL ‚Äî centrado 100% robusto
     ========================= */
  .modalOverlay{
  position: fixed;
  inset: 0;               /* en vez de top/left + 100vw/100vh */
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  display: grid;
  place-items: center;

  padding: 18px;
  z-index: 9999;
}


  .modalCard{
  width: min(860px, calc(100% - 36px)); /* antes: 100vw */
  max-height: min(80vh, 760px);
  overflow: auto;

  border-radius: 22px;
  border: 1px solid rgba(255,255,255,.16);
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
  box-shadow: 0 22px 70px rgba(0,0,0,.60);
  position: relative;


  -webkit-overflow-scrolling: touch;
}


  .modalHeader{
    position: sticky;
    top: 0;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 14px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.22);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .modalBody{ padding: 14px; }

  .sheetCard{
    width: min(360px, calc(100% - 32px));
    border-radius: 22px;
    border: 1px solid rgba(255,255,255,.16);
    background: linear-gradient(180deg, rgba(17,23,45,.94), rgba(9,13,28,.92));
    box-shadow: 0 18px 60px rgba(0,0,0,.65);
    overflow:hidden;
  }

  .sheetHeader{
    padding: 16px;
    border-bottom:1px solid rgba(255,255,255,.08);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .sheetTitle{
    display:flex;
    align-items:center;
    gap:10px;
    font-size:14px;
    color:var(--text);
  }

  .sheetBody{
    padding: 10px 8px 14px 8px;
    display:grid;
    gap:6px;
  }

  .sheetOption{
    display:flex;
    align-items:center;
    gap:10px;
    padding:12px 14px;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.05);
    cursor:pointer;
    transition: background .12s ease, border-color .12s ease;
  }
  .sheetOption:hover{
    background: rgba(255,255,255,.10);
    border-color: rgba(255,255,255,.18);
  }
  .sheetOption strong{font-size:13px; color:var(--text);}
  .sheetOption span{font-size:12px; color:var(--muted);}

  .sheetIcon{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:36px;
    height:36px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.08);
    font-size:18px;
  }

  body[data-theme="light"] .card{
    border:1px solid var(--stroke);
    box-shadow: var(--shadow);
  }

  body[data-theme="light"] .big,
  body[data-theme="light"] .mini,
  body[data-theme="light"] .item,
  body[data-theme="light"] .toggle,
  body[data-theme="light"] .btn,
  body[data-theme="light"] .pill,
  body[data-theme="light"] .kbd,
  body[data-theme="light"] .badge{
    background: rgba(255,255,255,.9);
    border:1px solid rgba(15,25,48,.12);
    box-shadow: var(--shadow2);
    color: var(--muted);
  }

  body[data-theme="light"] .btn{
    color: var(--text);
    background: rgba(15,25,48,.08);
    border-color: rgba(15,25,48,.14);
  }
  body[data-theme="light"] .btn.primary{
    background: rgba(32,188,126,.14);
    border-color: rgba(32,188,126,.28);
  }
  body[data-theme="light"] .btn.warn{
    background: rgba(235,174,60,.16);
    border-color: rgba(235,174,60,.30);
  }
  body[data-theme="light"] .btn.ghost{
    background: rgba(15,25,48,.08);
    border-color: rgba(15,25,48,.14);
  }

  body[data-theme="light"] .menuTrigger{
    background: rgba(15,25,48,.06);
    border-color: rgba(15,25,48,.12);
  }
  body[data-theme="light"] .menuTrigger:hover{
    background: rgba(15,25,48,.10);
    border-color: rgba(15,25,48,.20);
  }

  body[data-theme="light"] .fill{
    background: linear-gradient(90deg, rgba(32,188,126,.85), rgba(82,124,255,.72));
  }
  body[data-theme="light"] .fill.break{
    background: linear-gradient(90deg, rgba(235,174,60,.90), rgba(82,124,255,.68));
  }

  body[data-theme="light"] .modalCard{
    background: linear-gradient(180deg, rgba(255,255,255,.97), rgba(255,255,255,.90));
    border:1px solid rgba(15,25,48,.14);
  }

  body[data-theme="light"] .sheetCard{
    background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.92));
    border:1px solid rgba(15,25,48,.14);
    box-shadow: 0 22px 60px rgba(10,15,40,.18);
  }
  body[data-theme="light"] .sheetHeader{border-bottom:1px solid rgba(15,25,48,.10);}
  body[data-theme="light"] .sheetOption{
    border:1px solid rgba(15,25,48,.12);
    background: rgba(15,25,48,.04);
  }
  body[data-theme="light"] .sheetOption:hover{
    background: rgba(15,25,48,.08);
    border-color: rgba(15,25,48,.18);
  }
  body[data-theme="light"] .sheetIcon{
    border:1px solid rgba(15,25,48,.14);
    background: rgba(15,25,48,.08);
  }

  body[data-theme="light"] .toast{
    background: rgba(255,255,255,.92);
    border:1px solid rgba(15,25,48,.16);
    color: var(--text);
  }

  body[data-theme="light"] .switch{
    border-color: rgba(15,25,48,.12);
    background: rgba(15,25,48,.08);
  }
  body[data-theme="light"] .switch .knob{
    background: rgba(255,255,255,.94);
    box-shadow: 0 8px 18px rgba(20,30,55,.18);
  }
  body[data-theme="light"] .switch.theme.on{
    background: rgba(15,25,48,.14);
    border-color: rgba(15,25,48,.24);
  }
  body[data-theme="light"] .switch.theme.on .knob{
    background: rgba(255,255,255,.96);
  }

  body[data-theme="light"] .toggle{
    color: var(--muted);
  }

  body[data-theme="light"] .phaseLabel,
  body[data-theme="light"] .kbs,
  body[data-theme="light"] .item .itDesc,
  body[data-theme="light"] .toast span{
    color: rgba(15,25,48,.58);
  }

  body[data-theme="light"] .smallTag{
    border-color: rgba(15,25,48,.12);
    background: rgba(15,25,48,.05);
    color: rgba(15,25,48,.65);
  }

  body[data-theme="light"] .check{
    border:1px solid rgba(15,25,48,.18);
    background: rgba(15,25,48,.06);
  }
  body[data-theme="light"] .check.on{
    border-color: rgba(32,188,126,.35);
    background: rgba(32,188,126,.18);
  }
  body[data-theme="light"] .check.on:after{
    border-color: rgba(32,188,126,.95);
  }
  /* =========================
   SWITCH COLORS (ON states)
   ========================= */

/* AUTO ‚Üí verde siempre */
.switch.auto.on{
  background: rgba(77,255,158,.22);
  border-color: rgba(77,255,158,.45);
}
.switch.auto.on .knob{
  background: rgba(77,255,158,.95);
}

/* TEMA ‚Üí azul/morado siempre */
.switch.theme.on{
  background: rgba(124,92,255,.22);
  border-color: rgba(124,92,255,.45);
}
.switch.theme.on .knob{
  background: rgba(124,92,255,.95);
}

/* Ajuste extra para modo claro (mejor contraste) */
body[data-theme="light"] .switch.auto.on{
  background: rgba(77,255,158,.28);
  border-color: rgba(77,255,158,.55);
}

body[data-theme="light"] .switch.theme.on{
  background: rgba(124,92,255,.28);
  border-color: rgba(124,92,255,.55);
}
/* =========================
   SWITCH NEUTRAL (AJUSTES)
   ========================= */
.switch.neutral.on{
  background: rgba(255,255,255,.18);
  border-color: rgba(255,255,255,.35);
}
.switch.neutral.on .knob{
  background: rgba(255,255,255,.92);
}

/* Mejora contraste en modo claro */
body[data-theme="light"] .switch.neutral.on{
  background: rgba(0,0,0,.12);
  border-color: rgba(0,0,0,.28);
}
body[data-theme="light"] .switch.neutral.on .knob{
  background: rgba(0,0,0,.75);
}



</style>

  </head>

  <body>
    <div id="root"></div>

    <!-- React 18 + Babel (standalone single-file) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

 <script type="text/babel">
  const { useEffect, useMemo, useRef, useState } = React;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function formatMMSS(totalSeconds){
    const s = Math.max(0, Math.floor(totalSeconds));
    const mm = String(Math.floor(s / 60)).padStart(2, "0");
    const ss = String(s % 60).padStart(2, "0");
    return mm + ":" + ss;
  }

  function nowHHMM(){
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return hh + ":" + mm;
  }

  function requestNotifPermission(){
    if(!("Notification" in window)) return Promise.resolve("unsupported");
    if(Notification.permission === "granted") return Promise.resolve("granted");
    if(Notification.permission === "denied") return Promise.resolve("denied");
    return Notification.requestPermission();
  }

  function sendNotification(title, body){
    if(!("Notification" in window)) return;
    if(Notification.permission !== "granted") return;
    try{ new Notification(title, { body: body }); }catch(e){}
  }

function Modal({ open, title, children, onClose }) {
  if (!open) return null;

  return ReactDOM.createPortal(
    <div
      className="modalOverlay"
      onMouseDown={(e) => {
        if (e.target.classList.contains("modalOverlay")) {
          onClose();
        }
      }}
    >
      <div className="modalCard" role="dialog" aria-modal="true">
        <div className="modalHeader">
          <div style={{display:"flex", alignItems:"center", gap:10}}>
            <strong>{title}</strong>
            <span className="pill">Esc ¬∑ cerrar</span>
          </div>
          <button className="btn ghost" onClick={onClose}>‚úï</button>
        </div>

        <div className="modalBody">
          {children}
        </div>
      </div>
    </div>,
    document.body   // üëà CLAVE ABSOLUTA
  );
}

function QuickSheet({ open, title, subtitle, options, onSelect, onClose }) {
  useEffect(() => {
    if (!open) return;
    function onKey(e){ if(e.key === "Escape") onClose(); }
    window.addEventListener("keydown", onKey);
    return () => window.removeEventListener("keydown", onKey);
  }, [open, onClose]);

  if (!open) return null;

  return ReactDOM.createPortal(
    <div
      className="modalOverlay"
      onMouseDown={(e) => {
        if (e.target.classList.contains("modalOverlay")) {
          onClose();
        }
      }}
    >
      <div className="sheetCard" role="dialog" aria-modal="true">
        <div className="sheetHeader">
          <div className="sheetTitle">
            <span style={{fontSize:18, opacity:.7}}>‚ãÆ</span>
            <div style={{display:"grid", gap:4}}>
              <strong style={{fontSize:14}}>{title}</strong>
              {subtitle && <span style={{fontSize:12, color:"var(--muted)"}}>{subtitle}</span>}
            </div>
          </div>
          <button className="btn ghost" onClick={onClose}>‚úï</button>
        </div>

        <div className="sheetBody">
          {options.map((opt) => (
            <button
              key={opt.id}
              type="button"
              className="sheetOption"
              onClick={() => onSelect(opt)}
            >
              <span className="sheetIcon">{opt.icon}</span>
              <div style={{display:"grid", gap:4, textAlign:"left"}}>
                <strong>{opt.title}</strong>
                {opt.desc && <span>{opt.desc}</span>}
              </div>
            </button>
          ))}
        </div>
      </div>
    </div>,
    document.body
  );
}


  function App(){
    const focusDefault = 25 * 60;
    const breakDefault = 5 * 60;

    const [phase, setPhase] = useState("focus");
    const [running, setRunning] = useState(false);
    const [autoSwitch, setAutoSwitch] = useState(true);
    const [soundOn, setSoundOn] = useState(true);
    const [notifOn, setNotifOn] = useState(false);
    const [theme, setTheme] = useState(function(){
      const saved = localStorage.getItem("themeMode");
      if(saved === "light" || saved === "dark") return saved;
      if(window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches) return "light";
      return "dark";
    });

    const [focusLen, setFocusLen] = useState(focusDefault);
    const [breakLen, setBreakLen] = useState(breakDefault);
    const [secondsLeft, setSecondsLeft] = useState(focusDefault);

    const [toast, setToast] = useState(null);
    const toastTimerRef = useRef(null);

    const [lastCaffeineHHMM, setLastCaffeineHHMM] = useState(function(){
      const saved = localStorage.getItem("lastCaffeineHHMM");
      return saved || "";
    });

    const [cycles, setCycles] = useState(function(){
      const saved = localStorage.getItem("cyclesDone");
      return saved ? Number(saved) : 0;
    });

    // ---- MODALES ----
    const [openMicro, setOpenMicro] = useState(false);
    const [openOffice, setOpenOffice] = useState(false);
    const [openSettings, setOpenSettings] = useState(false);
    const [openQuickMenu, setOpenQuickMenu] = useState(false);

    // ---- Anti-sue√±o: acciones con logs + mini-timer ----
    const [actions, setActions] = useState(function(){
      const saved = localStorage.getItem("antiSleepActions_v1");
      if(saved){
        try { return JSON.parse(saved); } catch(e){}
      }
      return [
        { id:"move", title:"Caminar 3‚Äì5 min", desc:"Si te est√°s quedando dormido, lo peor es seguir sentado. Lev√°ntate.", icon:"üö∂", durationSec: 180, logs: [] },
        { id:"cold", title:"Agua fr√≠a (15‚Äì30s)", desc:"Cara / mu√±ecas / cuello. Activaci√≥n r√°pida sin cafe√≠na extra.", icon:"üíß", durationSec: 20, logs: [] },
        { id:"breathe", title:"Respiraci√≥n 1 min (de pie)", desc:"10 respiraciones fuertes: inhala 3‚Äì4s, exhala r√°pido.", icon:"üå¨Ô∏è", durationSec: 60, logs: [] },
        { id:"water", title:"Agua (ahora)", desc:"Sue√±o + deshidrataci√≥n es t√≠pico en oficina.", icon:"ü•§", durationSec: 10, logs: [] },
        { id:"light", title:"Luz natural 2‚Äì5 min", desc:"Ayuda a reajustar el reloj biol√≥gico del turno 5:30.", icon:"‚òÄÔ∏è", durationSec: 180, logs: [] },
      ];
    });

    useEffect(function(){
      localStorage.setItem("antiSleepActions_v1", JSON.stringify(actions));
    }, [actions]);

    const [activeActionId, setActiveActionId] = useState(null);
    const [actionSecondsLeft, setActionSecondsLeft] = useState(0);

    const totalThisPhase = phase === "focus" ? focusLen : breakLen;

    const progress = useMemo(function(){
      const done = totalThisPhase - secondsLeft;
      return clamp((done / totalThisPhase) * 100, 0, 100);
    }, [totalThisPhase, secondsLeft]);

    useEffect(function(){ localStorage.setItem("cyclesDone", String(cycles)); }, [cycles]);
    useEffect(function(){ localStorage.setItem("lastCaffeineHHMM", lastCaffeineHHMM || ""); }, [lastCaffeineHHMM]);
    useEffect(function(){
      if(theme === "light") document.body.setAttribute("data-theme", "light");
      else document.body.removeAttribute("data-theme");
      localStorage.setItem("themeMode", theme);
    }, [theme]);

    // ---- AUDIO (solo tras gesto del usuario) + sonidos por evento ----
    const audioCtxRef = useRef(null);

    function ensureAudioCtxFromGesture(){
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      if(!AudioCtx) return null;

      if(!audioCtxRef.current){
        audioCtxRef.current = new AudioCtx();
      }

      const ctx = audioCtxRef.current;
      if(ctx.state === "suspended"){
        ctx.resume().catch(function(){});
      }
      return ctx;
    }

    function playTone(ctx, freq, ms, gainValue){
      try{
        if(!ctx) return;

        const o = ctx.createOscillator();
        const g = ctx.createGain();

        o.type = "sine";
        o.frequency.value = freq;

        const t = ctx.currentTime;
        const g0 = gainValue || 0.10;

        g.gain.setValueAtTime(0.0001, t);
        g.gain.exponentialRampToValueAtTime(g0, t + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, t + (ms / 1000));

        o.connect(g);
        g.connect(ctx.destination);

        o.start(t);
        o.stop(t + (ms / 1000) + 0.02);
      }catch(e){}
    }

    function playSound(kind){
      const ctx = audioCtxRef.current;
      if(!ctx) return;
      if(ctx.state === "suspended"){
        ctx.resume().catch(function(){});
        return;
      }

      if(kind === "focusEnd"){
        playTone(ctx, 784, 140, 0.10);
        setTimeout(function(){ playTone(ctx, 988, 160, 0.10); }, 110);
        return;
      }
      if(kind === "breakEnd"){
        playTone(ctx, 523, 140, 0.10);
        setTimeout(function(){ playTone(ctx, 659, 170, 0.10); }, 110);
        return;
      }
      if(kind === "start"){ playTone(ctx, 880, 70, 0.07); return; }
      if(kind === "pause"){ playTone(ctx, 330, 70, 0.07); return; }
      if(kind === "reset"){
        playTone(ctx, 392, 80, 0.08);
        setTimeout(function(){ playTone(ctx, 392, 80, 0.08); }, 120);
        return;
      }
      if(kind === "switch"){ playTone(ctx, 660, 80, 0.07); return; }
      if(kind === "click"){ playTone(ctx, 1047, 35, 0.04); return; }
      if(kind === "open"){ playTone(ctx, 660, 45, 0.05); setTimeout(function(){ playTone(ctx, 880, 55, 0.05); }, 70); return; }
      if(kind === "close"){ playTone(ctx, 440, 50, 0.05); return; }
    }
    // ---- FIN AUDIO ----

    function showToast(title, body){
      setToast({ title: title, body: body });
      if(toastTimerRef.current) clearTimeout(toastTimerRef.current);
      toastTimerRef.current = setTimeout(function(){ setToast(null); }, 5200);
    }

    function logActionDone(actionId){
      const ts = Date.now();
      setActions(function(prev){
        return prev.map(function(a){
          if(a.id !== actionId) return a;
          const logs = (a.logs || []).slice();
          logs.push(ts);
          return Object.assign({}, a, { logs: logs });
        });
      });
    }

    function startActionTimer(actionId){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("click");

      const a = actions.find(function(x){ return x.id === actionId; });
      if(!a) return;

      setActiveActionId(actionId);
      setActionSecondsLeft(a.durationSec || 60);
      showToast("Hacer ahora: " + a.title, "Timer iniciado (" + formatMMSS(a.durationSec || 60) + ").");
    }

    function stopActionTimer(){
      setActiveActionId(null);
      setActionSecondsLeft(0);
    }

    useEffect(function(){
      if(!activeActionId) return;
      if(actionSecondsLeft <= 0) return;

      const id = setInterval(function(){
        setActionSecondsLeft(function(s){
          if(s <= 1) return 0;
          return s - 1;
        });
      }, 1000);

      return function(){ clearInterval(id); };
    }, [activeActionId, actionSecondsLeft]);

    useEffect(function(){
      if(!activeActionId) return;
      if(actionSecondsLeft !== 0) return;

      if(soundOn) playSound("breakEnd");
      logActionDone(activeActionId);

      const a = actions.find(function(x){ return x.id === activeActionId; });
      showToast("‚úÖ Acci√≥n completada", a ? (a.title + " registrada.") : "Registrada.");
      stopActionTimer();
    }, [actionSecondsLeft, activeActionId]);

    function addAction(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("click");

      const title = prompt("Nombre de la acci√≥n (ej: 'Subir escaleras 2 min'):");
      if(!title) return;

      const desc = prompt("Descripci√≥n corta (opcional):") || "";
      const icon = prompt("Emoji (ej: üî•, üö∂, üíß):") || "‚ú®";
      const dur = prompt("Duraci√≥n en segundos (ej: 120). Deja vac√≠o para 60:", "60");
      const durationSec = dur ? Math.max(5, Number(dur)) : 60;

      const id = "a_" + String(Date.now());
      const newItem = { id:id, title:title, desc:desc, icon:icon, durationSec: durationSec, logs: [] };

      setActions(function(prev){ return [newItem].concat(prev); });
      showToast("Acci√≥n agregada", title);
    }

    // Pomodoro tick
    useEffect(function(){
      if(!running) return;
      const id = setInterval(function(){
        setSecondsLeft(function(prev){
          if(prev <= 1) return 0;
          return prev - 1;
        });
      }, 1000);
      return function(){ clearInterval(id); };
    }, [running]);

    // Pomodoro ends
    useEffect(function(){
      if(secondsLeft !== 0) return;

      const onEnd = function(){
        if(soundOn){
          if(phase === "focus") playSound("focusEnd");
          else playSound("breakEnd");
        }

        if(phase === "focus"){
          sendNotification("‚è≥ Fin del foco", "Lev√°ntate 2‚Äì3 min: luz + movimiento. Luego 5 min de descanso.");
          showToast("Fin del foco", "Lev√°ntate 2‚Äì3 min: mu√©vete, agua y respira. (Atajo: Space)");
          setCycles(function(c){ return c + 1; });
        }else{
          sendNotification("‚úÖ Fin del descanso", "Vuelve al foco. Empieza con una tarea simple para arrancar.");
          showToast("Fin del descanso", "Vuelve al foco con una tarea simple. (Atajo: Space)");
        }

        if(autoSwitch){
          const next = phase === "focus" ? "break" : "focus";
          setPhase(next);
          setSecondsLeft(next === "focus" ? focusLen : breakLen);
          setRunning(true);
        }else{
          setRunning(false);
        }
      };

      const t = setTimeout(onEnd, 60);
      return function(){ clearTimeout(t); };
    }, [secondsLeft, autoSwitch, phase, focusLen, breakLen, soundOn]);

    // Align secondsLeft when not running
    useEffect(function(){
      if(running) return;
      setSecondsLeft(phase === "focus" ? focusLen : breakLen);
    }, [focusLen, breakLen, phase]);

    // Title
    useEffect(function(){
      const symbol = running ? (phase === "focus" ? "üéØ" : "‚òï") : "‚è∏Ô∏è";
      document.title = symbol + " " + formatMMSS(secondsLeft) + " ¬∑ Pomodoro";
    }, [secondsLeft, running, phase]);

    function toggleRun(){
      const ctx = ensureAudioCtxFromGesture();
      if(soundOn && ctx){
        if(running) playSound("pause");
        else playSound("start");
      }
      setRunning(function(v){ return !v; });
    }
function editAction(actionId){
  ensureAudioCtxFromGesture();
  if(soundOn) playSound("click");

  const a = actions.find(function(x){ return x.id === actionId; });
  if(!a) return;

  const title = prompt("Editar nombre:", a.title);
  if(title === null) return;

  const desc = prompt("Editar descripci√≥n:", a.desc || "");
  if(desc === null) return;

  const icon = prompt("Editar emoji:", a.icon || "‚ú®");
  if(icon === null) return;

  const dur = prompt("Editar duraci√≥n (segundos):", String(a.durationSec || 60));
  if(dur === null) return;

  const durationSec = Math.max(5, Number(dur) || 60);

  setActions(function(prev){
    return prev.map(function(it){
      if(it.id !== actionId) return it;
      return Object.assign({}, it, {
        title: title.trim() || it.title,
        desc: desc,
        icon: icon.trim() || it.icon,
        durationSec: durationSec
      });
    });
  });

  showToast("Editado", "Acci√≥n actualizada.");
}

function deleteAction(actionId){
  ensureAudioCtxFromGesture();
  if(soundOn) playSound("click");

  const a = actions.find(function(x){ return x.id === actionId; });
  if(!a) return;

  const ok = confirm("¬øEliminar esta acci√≥n?\n\n" + a.icon + " " + a.title);
  if(!ok) return;

  // si est√° corriendo, la detenemos
  if(activeActionId === actionId){
    stopActionTimer();
  }

  setActions(function(prev){
    return prev.filter(function(it){ return it.id !== actionId; });
  });

  showToast("Eliminado", "Acci√≥n borrada.");
}

function clearActionLogs(actionId){
  ensureAudioCtxFromGesture();
  if(soundOn) playSound("click");

  const a = actions.find(function(x){ return x.id === actionId; });
  if(!a) return;

  const ok = confirm("¬øBorrar historial (Hoy/Total/√öltima) de esta acci√≥n?\n\n" + a.icon + " " + a.title);
  if(!ok) return;

  setActions(function(prev){
    return prev.map(function(it){
      if(it.id !== actionId) return it;
      return Object.assign({}, it, { logs: [] });
    });
  });

  showToast("Historial borrado", "Registros reiniciados.");
}


    function resetTimer(){
      ensureAudioCtxFromGesture();
      setRunning(false);
      setSecondsLeft(phase === "focus" ? focusLen : breakLen);
      showToast("Reiniciado", "Timer reiniciado para esta fase.");
      if(soundOn) playSound("reset");
    }

    function switchPhase(next){
      ensureAudioCtxFromGesture();
      setRunning(false);
      setPhase(next);
      setSecondsLeft(next === "focus" ? focusLen : breakLen);
      showToast("Cambiado", next === "focus" ? "Modo Enfoque (25:00)" : "Modo Descanso (05:00)");
      if(soundOn) playSound("switch");
    }

    async function toggleNotif(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("click");

      const next = !notifOn;
      if(next){
        const perm = await requestNotifPermission();
        if(perm !== "granted"){
          showToast("Notificaciones", "No se pudo activar (permiso denegado o no soportado).");
          setNotifOn(false);
          return;
        }
        showToast("Notificaciones activadas", "Te avisar√© al terminar cada bloque.");
        setNotifOn(true);
      }else{
        setNotifOn(false);
        showToast("Notificaciones desactivadas", "Listo.");
      }
    }

    // Keyboard shortcuts
    useEffect(function(){
      const onKey = function(e){
        if(e.code === "Space"){
          e.preventDefault();
          ensureAudioCtxFromGesture();
          toggleRun();
        }
        const k = (e.key || "").toLowerCase();
        if(k === "r") resetTimer();
        if(k === "s"){
          ensureAudioCtxFromGesture();
          playSound("click");
          setSoundOn(function(v){ return !v; });
          showToast("Sonido", "Alternado con tecla S.");
        }
        if(k === "n") toggleNotif();
      };
      window.addEventListener("keydown", onKey);
      return function(){ window.removeEventListener("keydown", onKey); };
    }, [toggleNotif, phase, focusLen, breakLen, running, secondsLeft, soundOn, notifOn]);

    function setCaffeineNow(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("click");

      const hhmm = nowHHMM();
      setLastCaffeineHHMM(hhmm);
      showToast("‚òï Caf√© registrado", "√öltimo caf√©: " + hhmm + ". Ideal: evita despu√©s de 14:30‚Äì15:00.");
    }

    function caffeineHint(){
      if(!lastCaffeineHHMM) return "Registra tu √∫ltimo caf√© para no afectar el sue√±o de hoy.";
      return "√öltimo caf√©: " + lastCaffeineHHMM + ". Consejo: √∫ltimo caf√© antes de 14:30‚Äì15:00.";
    }

    function onAutoToggle(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("click");
      setAutoSwitch(function(v){ return !v; });
    }

    function onSoundToggle(){
      ensureAudioCtxFromGesture();
      playSound("click");
      setSoundOn(function(v){ return !v; });
    }

    function openMicroModal(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("open");
      setOpenMicro(true);
    }
    function closeMicroModal(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("close");
      setOpenMicro(false);
    }

    function openOfficeModal(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("open");
      setOpenOffice(true);
    }
    function closeOfficeModal(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("close");
      setOpenOffice(false);
    }

    function openSettingsModal(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("open");
      setOpenSettings(true);
    }
    function closeSettingsModal(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("close");
      setOpenSettings(false);
    }

    function openQuickMenuSheet(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("open");
      setOpenQuickMenu(true);
    }
    function closeQuickMenuSheet(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("close");
      setOpenQuickMenu(false);
    }

    function quickMenuGoToSettings(){
      closeQuickMenuSheet();
      openSettingsModal();
    }

    function handleQuickMenuSelect(opt){
      if(!opt) return;
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("click");
      if(typeof opt.action === "function") opt.action();
    }

    const quickMenuOptions = [
      {
        id: "settings",
        icon: "‚öôÔ∏è",
        title: "Ajustes r√°pidos",
        desc: "Duraciones, presets y contador de ciclos.",
        action: quickMenuGoToSettings
      },
      {
        id: "micro",
        icon: "üßØ",
        title: "Micro-acciones",
        desc: "Estrategias anti-sue√±o con timers.",
        action: function(){ closeQuickMenuSheet(); openMicroModal(); }
      },
      {
        id: "office",
        icon: "üìå",
        title: "Tips de oficina",
        desc: "Recordatorios para d√≠as con sue√±o.",
        action: function(){ closeQuickMenuSheet(); openOfficeModal(); }
      },
    ];

    function toggleThemeMode(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("click");
      setTheme(function(prev){
        const next = prev === "light" ? "dark" : "light";
        showToast("Tema", next === "light" ? "Modo claro activado." : "Oscuro activado.");
        return next;
      });
    }

    const phaseName = phase === "focus" ? "Enfoque" : "Descanso";
    const dotClassName = "dot " + (!running ? "paused" : (phase === "break" ? "break" : ""));

    return (
      <div className="wrap">
        <div className="app">

          {/* LEFT: Pomodoro */}
          <div className="card">
            <div className="pad">
              <div className="header">
                <div>
                  <div className="title">
                    <div className="badge">
                      <span className={dotClassName}></span>
                      <span>{phaseName}</span>
                      <span style={{opacity:.5}}>¬∑</span>
                      <span>{running ? "En marcha" : "Pausado"}</span>
                    </div>
                  </div>
                  <h1 style={{marginTop:10}}>Pomodoro 25/5 ¬∑ Focus & Wake</h1>
                  <p className="sub">
                    Dise√±ado para oficina y d√≠as con sue√±o: foco corto, descansos activos y recordatorios anti-micro-sue√±o.
                  </p>
                </div>

                {/* toggles + men√∫ r√°pido */}
                <div className="rightActions" style={{flexDirection:"column", alignItems:"flex-end", gap:10}}>
                  <div style={{display:"flex", flexWrap:"wrap", gap:10, justifyContent:"flex-end"}}>
                    <div className="toggle">
                      <span>Auto</span>
                      <div className={"switch auto " + (autoSwitch ? "on" : "")} onClick={onAutoToggle} role="button" aria-label="Auto switch">
                        <div className="knob"></div>
                      </div>
                    </div>

                    <div className="toggle">
                      <span>Sonido</span>
                      <div className={"switch good " + (soundOn ? "on" : "")} onClick={onSoundToggle} role="button" aria-label="Sound">
                        <div className="knob"></div>
                      </div>
                    </div>

                    <div className="toggle">
                      <span>Notif</span>
                      <div className={"switch warn " + (notifOn ? "on" : "")} onClick={toggleNotif} role="button" aria-label="Notifications">
                        <div className="knob"></div>
                      </div>
                    </div>

                    <div className="toggle">
                      <span>Tema</span>
                      <span>{theme === "dark" ? "üåô" : "‚òÄÔ∏è"}</span>
                      <div
                        className={"switch theme " + (theme === "light" ? "on" : "")}
                        onClick={toggleThemeMode}
                        role="button"
                        aria-label="Theme"
                      >
                        <div className="knob"></div>
                      </div>
                    </div>
                  </div>
                  <button
                    type="button"
                    className="menuTrigger"
                    aria-label="Abrir men√∫ r√°pido"
                    onClick={openQuickMenuSheet}
                  >
                    ‚ãÆ
                  </button>
                </div>
              </div>

              <div className="timerArea">
                {/* BIG: timer */}
                <div className="big">
                  <div className="clockRow">
                    <div className="phaseLabel">
                      <span className="pill">{phase === "focus" ? "üéØ Foco" : "‚òï Descanso"}</span>
                      <span className="pill">Ciclos: <span style={{fontFamily:"var(--mono)", marginLeft:6}}>{cycles}</span></span>
                    </div>
                    <div className="pill">Meta: {phase === "focus" ? "25m" : "5m"}</div>
                  </div>

                  <div className={"time " + (running ? "pulse" : "")}>
                    {formatMMSS(secondsLeft)}
                  </div>

                  <div className="progressWrap">
                    <div className="bar" aria-label="progress bar">
                      <div className={"fill " + (phase === "break" ? "break" : "")} style={{width: progress + "%"}}></div>
                    </div>
                    <div style={{display:"flex", justifyContent:"space-between", marginTop:8, color:"var(--muted)", fontSize:12}}>
                      <span>Progreso</span>
                      <span style={{fontFamily:"var(--mono)"}}>{Math.round(progress)}%</span>
                    </div>
                  </div>

                  <div className="controls">
                    <button className={"btn " + (running ? "warn" : "primary")} onClick={toggleRun}>
                      {running ? "‚è∏Ô∏è Pausar" : "‚ñ∂Ô∏è Iniciar"}
                    </button>
                    <button className="btn ghost" onClick={resetTimer}>‚Ü∫ Reiniciar</button>
                    <button className="btn" onClick={function(){ switchPhase("focus"); }}>üéØ Foco</button>
                    <button className="btn" onClick={function(){ switchPhase("break"); }}>‚òï Descanso</button>
                  </div>

                  <div className="kbs">
                    <span className="kbd">Space ¬∑ Play/Pause</span>
                    <span className="kbd">R ¬∑ Reset</span>
                    <span className="kbd">S ¬∑ Sonido</span>
                    <span className="kbd">N ¬∑ Notif</span>
                    <span className="kbd">Esc ¬∑ Cierra modales</span>
                  </div>
                </div>

                {/* RIGHT of timerArea: simple info (opcional) */}
                <div className="big">
                  <div className="sectionTitle">
                    <h2>üìå Acciones</h2>
                    <span className="pill">Menu</span>
                  </div>

                  <div style={{display:"grid", gap:10}}>
                    <button className="btn primary" onClick={openMicroModal}>üßØ Micro-acciones</button>
                    <button className="btn" onClick={openOfficeModal}>üìå Recomendaciones oficina</button>

                    {activeActionId && (
                      <div className="pill" style={{display:"inline-flex", gap:8, flexWrap:"wrap"}}>
                        ‚è±Ô∏è Acci√≥n en curso: {formatMMSS(actionSecondsLeft)} ¬∑{" "}
                        {actions.find(function(a){ return a.id === activeActionId; }) ? actions.find(function(a){ return a.id === activeActionId; }).icon : ""}{" "}
                        {actions.find(function(a){ return a.id === activeActionId; }) ? actions.find(function(a){ return a.id === activeActionId; }).title : ""}
                      </div>
                    )}

                    <div style={{color:"var(--muted)", fontSize:12, lineHeight:1.45}}>
                      Si te est√°s quedando dormido: lev√°ntate 2‚Äì3 min, agua fr√≠a y respiraci√≥n r√°pida.
                      Luego vuelve al foco con una tarea simple.
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>

        

          <QuickSheet
            open={openQuickMenu}
            title="Men√∫ r√°pido"
            subtitle="Accesos frecuentes"
            options={quickMenuOptions}
            onSelect={handleQuickMenuSelect}
            onClose={closeQuickMenuSheet}
          />

          {/* MODAL: Ajustes */}
          <Modal open={openSettings} title="‚öôÔ∏è Ajustes r√°pidos" onClose={closeSettingsModal}>
            <div className="sectionTitle">
              <h2>Duraciones</h2>
              <span className="pill">config</span>
            </div>

            <div className="grid2">
              <div>
                <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:8}}>
                  <span className="pill">Foco (min)</span>
                  <span className="smallTag">{Math.round(focusLen/60)}m</span>
                </div>
                <input
                  type="range"
                  min="15"
                  max="60"
                  value={Math.round(focusLen/60)}
                  onChange={function(e){
                    ensureAudioCtxFromGesture();
                    if(soundOn) playSound("click");
                    setFocusLen(Number(e.target.value)*60);
                  }}
                  style={{width:"100%"}}
                />
                <div style={{color:"var(--muted)", fontSize:12, marginTop:6}}>
                  Recomendado si est√°s con sue√±o: 20‚Äì25 min.
                </div>
              </div>

              <div>
                <div style={{display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:8}}>
                  <span className="pill">Descanso (min)</span>
                  <span className="smallTag">{Math.round(breakLen/60)}m</span>
                </div>
                <input
                  type="range"
                  min="3"
                  max="15"
                  value={Math.round(breakLen/60)}
                  onChange={function(e){
                    ensureAudioCtxFromGesture();
                    if(soundOn) playSound("click");
                    setBreakLen(Number(e.target.value)*60);
                  }}
                  style={{width:"100%"}}
                />
                <div style={{color:"var(--muted)", fontSize:12, marginTop:6}}>
                  Descansos activos: de pie, luz, agua.
                </div>
              </div>
            </div>

            <div style={{marginTop:12, display:"flex", gap:10, flexWrap:"wrap"}}>
              <button className="btn" onClick={function(){
                ensureAudioCtxFromGesture(); if(soundOn) playSound("click");
                setFocusLen(25*60); setBreakLen(5*60);
                showToast("Preset", "25/5 aplicado.");
              }}>
                25/5
              </button>

              <button className="btn" onClick={function(){
                ensureAudioCtxFromGesture(); if(soundOn) playSound("click");
                setFocusLen(20*60); setBreakLen(5*60);
                showToast("Preset", "20/5 aplicado (anti-sue√±o).");
              }}>
                20/5 (anti-sue√±o)
              </button>

              <button className="btn" onClick={function(){
                ensureAudioCtxFromGesture(); if(soundOn) playSound("click");
                setCycles(0);
                showToast("Ciclos", "Contador reiniciado.");
              }}>
                Reiniciar ciclos
              </button>
            </div>

            <div style={{marginTop:14}}>
              <div className="sectionTitle">
                <h2>‚òï Corte de cafe√≠na</h2>
                <span className="pill">salud del sue√±o</span>
              </div>
              <div style={{display:"flex", gap:10, flexWrap:"wrap", alignItems:"center"}}>
                <button className="btn primary" onClick={setCaffeineNow}>Registrar caf√© ahora</button>
                <span style={{color:"var(--muted)", fontSize:12}}>{caffeineHint()}</span>
              </div>
            </div>
          </Modal>

          {/* MODAL: Micro-acciones */}
          <Modal open={openMicro} title="üßØ Anti-sue√±o (r√°pido) ‚Äî Micro-acciones" onClose={closeMicroModal}>
            <div style={{display:"flex", gap:10, flexWrap:"wrap", marginBottom:10}}>
              <button className="btn" onClick={addAction}>Ôºã Agregar acci√≥n</button>
              {activeActionId && (
                <span className="pill">
                  ‚è±Ô∏è {formatMMSS(actionSecondsLeft)} ¬∑{" "}
                  {actions.find(function(a){ return a.id === activeActionId; }) ? actions.find(function(a){ return a.id === activeActionId; }).icon : ""}{" "}
                  {actions.find(function(a){ return a.id === activeActionId; }) ? actions.find(function(a){ return a.id === activeActionId; }).title : ""}
                </span>
              )}
            </div>

            <ul className="list">
              {actions.map(function(a){
                const logs = a.logs || [];

                const today = new Date();
                today.setHours(0,0,0,0);
                const todayTs = today.getTime();

                const doneToday = logs.filter(function(t){ return t >= todayTs; }).length;

                const last = logs.length ? new Date(logs[logs.length - 1]) : null;
                const lastStr = last
                  ? (String(last.getHours()).padStart(2,"0") + ":" + String(last.getMinutes()).padStart(2,"0"))
                  : "‚Äî";

                const isRunning = activeActionId === a.id;

                return (
                  <li className="item" key={a.id}>
                    <div style={{display:"flex", flexDirection:"column", gap:8, width:"100%"}}>
                      <div style={{display:"flex", justifyContent:"space-between", gap:10}}>
                        <div className="itText">
                          <div className="itTop">
                            <p className="itTitle">{a.title}</p>
                            <span className="smallTag">{a.icon}</span>
                          </div>
                          <p className="itDesc">{a.desc}</p>

                          <div style={{display:"flex", gap:8, flexWrap:"wrap", marginTop:8}}>
                            <span className="smallTag">Hoy: {doneToday}</span>
                            <span className="smallTag">Total: {logs.length}</span>
                            <span className="smallTag">√öltima: {lastStr}</span>
                            <span className="smallTag">Dur: {formatMMSS(a.durationSec || 60)}</span>
                          </div>
                        </div>

                        <div style={{display:"flex", flexDirection:"column", gap:8, alignItems:"flex-end"}}>
  <button
    className={"btn " + (isRunning ? "warn" : "")}
    onClick={function(){
      ensureAudioCtxFromGesture();
      if(isRunning){
        stopActionTimer();
        if(soundOn) playSound("pause");
      }else{
        startActionTimer(a.id);
      }
    }}
  >
    {isRunning ? "‚è∏Ô∏è Parar" : "‚è±Ô∏è Hacer ahora"}
  </button>

  <button
    className="btn primary"
    onClick={function(){
      ensureAudioCtxFromGesture();
      if(soundOn) playSound("start");
      logActionDone(a.id);
      showToast("‚úÖ Hecho", a.title + " registrado.");
    }}
  >
    +1 Hecho
  </button>

  <div style={{display:"flex", gap:8}}>
    <button className="btn ghost" onClick={function(){ editAction(a.id); }}>
      ‚úèÔ∏è Editar
    </button>

    <button className="btn ghost" onClick={function(){ clearActionLogs(a.id); }}>
      üßπ Hist
    </button>

    <button className="btn ghost" onClick={function(){ deleteAction(a.id); }}>
      üóëÔ∏è Eliminar
    </button>
  </div>
</div>

                      </div>
                    </div>
                  </li>
                );
              })}
            </ul>
          </Modal>

          {/* MODAL: Recomendaciones oficina */}
          <Modal open={openOffice} title="üìå Recomendaciones (oficina)" onClose={closeOfficeModal}>
            <div style={{color:"var(--muted)", fontSize:12, lineHeight:1.5}}>
              <div style={{marginBottom:10}}>
                <span className="pill">Regla de oro</span>
                <div style={{marginTop:8}}>
                  Si sientes que te duermes: <strong>lev√°ntate</strong>, camina 2‚Äì3 min, agua fr√≠a, respira.
                </div>
              </div>

              <div style={{marginBottom:10}}>
                <span className="pill">Caf√© inteligente</span>
                <div style={{marginTop:8}}>
                  Mejor ¬Ω taza antes de 15:00 que una grande tarde (te destruye la noche).
                </div>
              </div>

              <div style={{marginBottom:10}}>
                <span className="pill">Luz + movimiento</span>
                <div style={{marginTop:8}}>
                  Aprovecha descansos para luz natural y caminar. Aunque est√© nublado, sirve.
                </div>
              </div>

              <div>
                <span className="pill">Noche</span>
                <div style={{marginTop:8}}>
                  Si te levantas 5:30, apunta a <strong>cama 22:15‚Äì22:30</strong>.
                </div>
              </div>
            </div>
          </Modal>

          {toast && (
            <div className="toast">
              <div>
                <strong>{toast.title}</strong>
                <span>{toast.body}</span>
              </div>
              <button className="btn" onClick={function(){ ensureAudioCtxFromGesture(); if(soundOn) playSound("click"); setToast(null); }}>
                Cerrar
              </button>
            </div>
          )}

        </div>
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>

  </body>
</html>
